# 統合型会話練習機能 - 聞く力マスタープログラム

## 概要

本機能は、婚活における会話スキルを体系的に習得するための統合型練習プログラムです。「会話を引き出す」基礎技術から「深堀りする」応用技術まで、段階的にスキルアップできる設計となっています。

### 機能の目的
- 婚活男性の「聞く力」を徹底的に強化
- 女性との会話における苦手意識の克服
- 実践的な質問技術の習得
- 相手の価値観や内面を引き出す能力の開発

### 統合のメリット
- 基礎から応用まで一貫した学習体験
- スキルの段階的な積み上げが可能
- 進捗状況の一元管理
- 効率的な学習パスの提供

## レベル設計

### 🟢 初級レベル：基本的な会話引き出し技術

#### 目標
- 相手が話しやすい環境を作る
- オープンエンドな質問の習得
- 基本的な相槌と反応の練習

#### 学習内容
1. **アイスブレイク質問**
   - 天気や季節の話題
   - 軽い趣味の話題
   - 日常的な出来事について

2. **基本的な引き出し質問**
   - 「休日は何をされていますか？」
   - 「お仕事はどんなことをされているんですか？」
   - 「最近楽しかったことは何ですか？」

3. **適切な相槌技術**
   - 「そうなんですね」の使い分け
   - 共感を示す表現
   - 興味を示すリアクション

#### 既存の練習シナリオ（初級）

##### elicit_001: 趣味について聞く場面
- **状況**: 初デートで相手の趣味について聞く場面
- **女性の発言**: 「そうですね...特に趣味らしい趣味はないかもしれません。」
- **正解**: 「休日はどんなことをして過ごされているんですか？」
- **学習ポイント**: 「趣味」という言葉にこだわらず、別の角度から話題を見つける

##### deepen_001: 仕事について深掘り
- **状況**: デート中に相手の仕事について話している場面
- **女性の発言**: 「私は事務の仕事をしています。」
- **正解**: 「事務のお仕事で一番やりがいを感じるのはどんな時ですか？」
- **学習ポイント**: 職業名だけでなく、感情に関わる質問で人柄を知る

##### deepen_002: 旅行体験の深掘り
- **状況**: お茶を飲みながら旅行の話になった場面
- **女性の発言**: 「去年、沖縄に行ったんです。とても良かったです。」
- **正解**: 「沖縄のどこが一番印象的でしたか？」
- **学習ポイント**: 体験談から感情や感想を聞き出す

##### elicit_002: 食事の好みについて
- **状況**: デート中に食事の話題になった場面
- **女性の発言**: 「私、実は少し好き嫌いが多いんです。」
- **正解**: 「そうなんですか。何が苦手なんですか？」
- **学習ポイント**: 否定せず、具体的に聞くことで理解を深める

### 🟡 中級レベル：応用的な質問と軽い深堀り

#### 目標
- 話題の自然な展開方法の習得
- 感情に焦点を当てた質問
- 相手の興味関心を探る技術

#### 学習内容
1. **話題展開テクニック**
   - 関連する話題への移行
   - 具体例を求める質問
   - 体験や思い出を引き出す

2. **感情フォーカス質問**
   - 「それはどんな気持ちでしたか？」
   - 「一番印象に残っているのは？」
   - 「どんなところが良かったですか？」

3. **価値観を探る入門**
   - 好きな理由を聞く
   - 大切にしていることを知る
   - 将来の希望を軽く聞く

#### 既存の練習シナリオ（中級）

##### deepen_003: 家族構成の深掘り
- **状況**: カフェで家族の話になった場面
- **女性の発言**: 「私は3人兄弟の真ん中なんです。」
- **正解**: 「真ん中だと、どんな性格になりましたか？」
- **学習ポイント**: 生い立ちが性格に与えた影響を聞き、内面を理解する

##### elicit_003: 仕事の悩みを引き出す
- **状況**: お茶をしながら仕事の話になった場面
- **女性の発言**: 「最近、仕事でちょっと悩んでいることがあって...」
- **正解**: 「大丈夫ですか？何か力になれることがあれば聞きますよ。」
- **学習ポイント**: 相手を気遣いながら話を聞く姿勢を示す

##### elicit_004: 休日の過ごし方を詳しく聞く
- **状況**: 休日の過ごし方について話している場面
- **女性の発言**: 「私、休日はだいたい家でゆっくりしていることが多いです。」
- **正解**: 「家ではどんなことをして過ごされているんですか？」
- **学習ポイント**: 決めつけずに具体的な過ごし方を聞く

### 🔴 上級レベル：高度な深堀り質問と分析技術

#### 目標
- 価値観や人生観を引き出す
- 複雑な感情を理解する質問
- 将来のビジョンを共有する会話
- 交際中のカップルとしての高度なコミュニケーション

#### 学習内容
1. **感情の読み取り（2シナリオ）**
   - 表情や声のトーンの変化への対応
   - 言葉の裏にある複雑な感情の理解

2. **適切な自己開示（2シナリオ）**
   - 相手と同レベルの個人的な話のシェア
   - デリケートな話題での信頼関係構築

3. **価値観の探究（2シナリオ）**
   - 人生観・結婚観の背景を理解する質問
   - 表面的でない本質的な価値観の探索

4. **デリケートな話題への配慮（2シナリオ）**
   - 重要な人生決断への適切なサポート
   - 健康問題等のプライベートな悩みへの対応

5. **関係性の発展（1シナリオ）**
   - 将来を見据えた関係性の話し合い
   - 結婚を視野に入れた誠実なコミュニケーション

6. **雰囲気のコントロール（1シナリオ）**
   - 重い話題後の自然な雰囲気転換
   - 相手の感情を大切にした会話の流れ作り

#### 既存の練習シナリオ（上級）

##### elicit_005: 将来の不安について
- **状況**: 将来の話題になった場面
- **女性の発言**: 「将来のことを考えると、少し不安になることもあります。」
- **正解**: 「どんなことが特に不安に感じられるんですか？」
- **学習ポイント**: 不安の内容を具体的に聞き、価値観を理解する

#### 新規追加シナリオ（上級・交際中カップル向け）

##### advanced_001: 感情の読み取り - デート中の心配事
- **状況**: 交際6ヶ月のカップル。夜景の見えるレストランでディナー中、相手の表情が少し曇る
- **女性の発言**: 「最近、職場で少し嫌なことがあって...それで今日も少し疲れちゃって。」
- **正解**: 「大変でしたね。もしよろしければ、お話聞かせてもらえますか？無理にとは言いませんが。」
- **学習ポイント**: 相手の感情変化を察知し、聞く姿勢を示しつつプレッシャーを与えない配慮

##### advanced_002: 感情の読み取り - 将来への複雑な感情
- **状況**: 交際4ヶ月のカップル。カフェで将来の話をしている時、相手が急に黙り込む
- **女性の発言**: 「結婚とか将来のことって...（少し沈んだ表情で）正直、うまくイメージできないんです。」
- **正解**: 「イメージできないのは自然なことだと思います。何か不安に感じることがあるんでしょうか？」
- **学習ポイント**: 言葉の裏にある複雑な感情を受容し、優しく本音を聞き出す

##### advanced_003: 適切な自己開示 - 過去の恋愛体験
- **状況**: 交際5ヶ月のカップル。散歩中に過去の恋愛について話題になる
- **女性の発言**: 「実は私、過去に一度結婚を考えた人がいたんですが、価値観の違いで別れてしまって...すごく辛かった経験です。」
- **正解**: 「僕も似たような経験があります。辛かったでしょうね。その経験から、パートナーに何を一番大切にしてほしいと思うようになりましたか？」
- **学習ポイント**: 同レベルの自己開示で信頼関係を築き、建設的な方向へ導く

##### advanced_004: 適切な自己開示 - 家族関係の複雑さ
- **状況**: 交際8ヶ月のカップル。お互いの家で映画鑑賞後、家族の話になる
- **女性の発言**: 「実は私、父親との関係があまり良くなくて...小さい頃から厳しすぎて、今でも実家に帰るのが少し憂鬱なんです。」
- **正解**: 「話してくれてありがとう。実は僕も親との関係で悩んだ時期があって...家族って近いからこそ難しいこともありますよね。」
- **学習ポイント**: 似た経験での共感を示し、相手を孤立させない配慮

##### advanced_005: 価値観の探究 - 人生観の深堀り
- **状況**: 交際7ヶ月のカップル。ドライブ中に仕事と人生について話している
- **女性の発言**: 「仕事にやりがいを感じているけれど、このまま仕事だけの人生でいいのかなって時々考えるんです。」
- **正解**: 「そう感じるのは、心の中で本当に大切にしたいものが他にもあるからかもしれませんね。どんな時に一番充実感を感じますか？」
- **学習ポイント**: 内面の価値観に焦点を当て、本質的な質問で人生観を探究

##### advanced_006: 価値観の探究 - 結婚観の背景理解
- **状況**: 交際10ヶ月のカップル。公園のベンチで将来の結婚生活について話している
- **女性の発言**: 「結婚って、お互いが成長し続けられる関係がいいなって思うんです。でも具体的にどういうことかって言われると難しくて...」
- **正解**: 「素敵な考えですね。そう思うようになったのは、何か特別な経験があったからですか？」
- **学習ポイント**: 価値観の形成背景を探ることで、より深い理解を得る

##### advanced_007: デリケートな配慮 - 人生決断の悩み
- **状況**: 交際6ヶ月のカップル。相手の部屋で夜遅くまで話していて、転職の悩みを打ち明けられる
- **女性の発言**: 「実は今の会社を辞めようか本気で悩んでいて...でも転職がうまくいくか不安だし、あなたに迷惑をかけるかもしれないし...」
- **正解**: 「僕のことは気にしないで、自分の気持ちを一番大切にして。一緒に考えられることがあれば何でも言って。」
- **学習ポイント**: 相手の自主性を尊重し、サポートの意思を示しつつ不安を取り除く

##### advanced_008: デリケートな配慮 - 健康問題への対応
- **状況**: 交際9ヶ月のカップル。カフェで相手から健康面での不安を打ち明けられる
- **女性の発言**: 「実は最近、体調のことで病院に通っていて...大したことじゃないと思うけど、将来のことを考えると少し心配で...」
- **正解**: 「話してくれてありがとう。無理をしないでくださいね。何かサポートできることがあればいつでも言ってください。」
- **学習ポイント**: プライバシーを尊重し、必要以上に踏み込まずサポートの姿勢を示す

##### advanced_009: 関係性の発展 - 将来への真剣な話し合い
- **状況**: 交際11ヶ月のカップル。お互いの将来について具体的に話し合う段階になった夜のドライブ中
- **女性の発言**: 「私たち、付き合って1年近くになりますね...この関係をどんな風に育てていきたいか、あなたの正直な気持ちを聞かせてもらえますか？」
- **正解**: 「僕は君ともっと深い関係になりたいと思っています。結婚も視野に入れて、お互いの将来を一緒に考えていけたらと思うのですが、君はどう感じていますか？」
- **学習ポイント**: 誠実で具体的な気持ちを伝えつつ、相手の意見も同等に大切にする

##### advanced_010: 雰囲気のコントロール - 重い話題後の自然な転換
- **状況**: 交際8ヶ月のカップル。レストランで重い家族の話が終わり、雰囲気を自然に明るくしたい場面
- **女性の発言**: 「...そんなこともあって、家族のことは複雑なんです。（少し沈んだ表情）でも、話を聞いてくれてありがとう。」
- **正解**: 「話してくれて本当にありがとう。君がそういう経験を乗り越えて、今こうして素敵な人になったんだなって改めて思います。」
- **学習ポイント**: 相手の経験を肯定的に意味づけることで、自然で心地よい雰囲気転換を行う

## mp3音声ファイル再生機能

### 音声ファイル管理システム

#### ディレクトリ構造
```
/public/audio/shadowing/
├── elicit_001.mp3    # 休日の過ごし方質問
├── elicit_002.mp3    # 食事の好み質問
├── elicit_003.mp3    # 仕事の悩み対応
├── elicit_004.mp3    # 家での過ごし方質問
├── elicit_005.mp3    # 将来の不安対応
├── deepen_001.mp3    # 仕事のやりがい質問
├── deepen_002.mp3    # 旅行の印象質問
└── deepen_003.mp3    # 家族構成の影響質問
```

#### 音声ファイル仕様
- 形式：MP3（128kbps）
- 長さ：5〜15秒
- 内容：プロの声優による模範音声
- トーン：優しく興味深そうな話し方

### 音声プレーヤー機能

#### 基本機能
```javascript
const AudioPlayer = {
  // 再生制御
  play: () => void,
  pause: () => void,
  stop: () => void,
  
  // 再生速度調整
  setPlaybackRate: (rate: number) => void, // 0.5x〜2.0x
  
  // 区間リピート
  setLoopStart: (time: number) => void,
  setLoopEnd: (time: number) => void,
  toggleLoop: () => void,
  
  // 音量調整
  setVolume: (volume: number) => void, // 0〜1
  
  // 進捗表示
  getCurrentTime: () => number,
  getDuration: () => number
}
```

#### UI設計
```
┌─────────────────────────────────────┐
│ 🎧 模範音声プレーヤー                │
│                                      │
│ ▶️ ⏸️ ⏹️  [━━━━━●━━━━━] 00:05/00:10 │
│                                      │
│ 速度: [0.5][0.75][1.0✓][1.25][1.5]  │
│ 音量: [━━━━━●━━━━] 70%              │
│                                      │
│ [🔁 リピート] [📊 波形表示]          │
└─────────────────────────────────────┘
```

### シャドーイング練習機能

#### 練習フロー
1. **模範音声の確認**
   - 音声を聞いて内容を理解
   - トーンと話し方を分析

2. **同時発声練習**
   - 音声に合わせて発声
   - タイミングの確認

3. **録音比較**
   - 自分の声を録音
   - 模範音声と比較

#### 録音機能
```javascript
const RecordingSystem = {
  // 録音制御
  startRecording: async () => void,
  stopRecording: async () => void,
  
  // 録音データ管理
  saveRecording: (blob: Blob) => Promise<string>,
  loadRecording: (id: string) => Promise<Blob>,
  
  // 波形分析
  analyzeWaveform: (audio: Blob) => WaveformData,
  compareWaveforms: (model: Blob, user: Blob) => ComparisonResult
}
```

## データ構造仕様

### 統合シナリオデータ（現在のデータ構造を維持）
```javascript
{
  id: "elicit_001",
  category: "elicit",  // "elicit" | "deepen"
  level: "beginner",   // "beginner" | "intermediate" | "advanced"
  tags: ["趣味", "初対面", "デート"],
  situation: "初デートで相手の趣味について聞く場面",
  womanText: "そうですね...特に趣味らしい趣味はないかもしれません。",
  question: "相手が「特に趣味はない」と言った時、どのように会話を続けますか？",
  options: [
    {
      id: "A",
      text: "そうですか、それは残念ですね。",
      feedback: "❌ 会話が終わってしまいます。相手の答えを受け入れつつ、別の角度から引き出してみましょう。",
      score: 0
    },
    // ... 他の選択肢
  ],
  correctAnswer: "C",
  explanation: "相手が「趣味がない」と言っても、休日の過ごし方や興味があることは必ずあります。",
  shadowingAudio: "/audio/shadowing/elicit_001.mp3",
  shadowingText: "休日はどんなことをして過ごされているんですか？",
  tip: "「趣味」という言葉にこだわらず、「休日の過ごし方」など、別の表現で聞いてみましょう。",
  createdAt: "2025-01-21",
  updatedAt: "2025-01-21"
}
```

### ユーザー進捗データ
```typescript
interface UserProgress {
  userId: string;
  
  levelProgress: {
    beginner: {
      completed: number;
      total: number;
      accuracy: number;
      lastPracticed: Date;
    };
    intermediate: { /* 同様 */ };
    advanced: { /* 同様 */ };
  };
  
  skillMetrics: {
    elicitingSkill: number; // 0-100
    deepeningSkill: number; // 0-100
    empathyScore: number;   // 0-100
    responseTime: number;   // 平均応答時間
  };
  
  audioProgress: {
    totalListeningTime: number;
    recordingCount: number;
    shadowingAccuracy: number;
    favoriteScenarios: string[];
  };
  
  achievements: {
    id: string;
    name: string;
    unlockedAt: Date;
  }[];
}
```

## レベル間のProgression ロジック

### 進級条件
```typescript
const progressionRules = {
  beginnerToIntermediate: {
    minCompletion: 80, // 80%以上のシナリオ完了
    minAccuracy: 75,   // 75%以上の正答率
    minPracticeTime: 120, // 120分以上の練習
  },
  
  intermediateToAdvanced: {
    minCompletion: 85,
    minAccuracy: 80,
    minPracticeTime: 180,
    requiredSkills: ['emotion_focus', 'topic_transition']
  }
};
```

### 適応的学習アルゴリズム
```typescript
function getNextScenario(userProgress: UserProgress): IntegratedScenario {
  // 1. 現在のレベルを判定
  const currentLevel = determineUserLevel(userProgress);
  
  // 2. 苦手分野を特定
  const weakAreas = identifyWeakAreas(userProgress);
  
  // 3. 最適な次のシナリオを選択
  return selectOptimalScenario({
    level: currentLevel,
    weakAreas,
    recentHistory: userProgress.recentScenarios,
    preferredCategories: userProgress.preferences
  });
}
```

### スキルマップ
```
初級スキル（4問）
├── 基本的な質問（elicit_001, elicit_002）
├── 相槌・リアクション
└── 話題の提供（deepen_001, deepen_002）

中級スキル（3問）
├── 話題の展開（elicit_004）
├── 感情への焦点（elicit_003）
└── 具体例の引き出し（deepen_003）

上級スキル（11問）
├── 感情の読み取り（advanced_001, advanced_002）
├── 適切な自己開示（advanced_003, advanced_004）
├── 価値観の探究（advanced_005, advanced_006）
├── デリケートな話題への配慮（advanced_007, advanced_008）
├── 関係性の発展（advanced_009）
├── 雰囲気のコントロール（advanced_010）
└── 将来の話題（elicit_005）
```

## 実装における技術要件

### フロントエンド
- React/Next.js コンポーネント
- Web Audio API（音声処理）
- MediaRecorder API（録音機能）
- Canvas API（波形表示）

### バックエンド
- 音声ファイル管理API
- 進捗トラッキングAPI
- 分析・レポートAPI

### データベース
- シナリオマスターデータ
- ユーザー進捗データ
- 録音データメタ情報

## 今後の拡張予定

1. **シナリオの追加**
   - 各レベルに最低10個ずつのシナリオを追加
   - より実践的な場面設定の充実

2. **AI音声生成統合**
   - OpenAI TTSによる動的な音声生成
   - ユーザーカスタマイズ音声の提供

3. **詳細な分析機能**
   - トーン分析
   - 話速分析
   - 感情表現分析

この統合型機能により、ユーザーは基礎から応用まで体系的に「聞く力」を習得し、婚活における会話力を飛躍的に向上させることができます。