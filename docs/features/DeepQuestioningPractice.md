# 深堀り質問練習機能実装ドキュメント

## 概要

婚活における会話で重要な「深堀り質問スキル」を身につけるための専用練習機能です。相手の表面的な答えに対して、さらに詳しく聞き出すための質問技術を体系的に学習できます。

**重要なポイント：**
- 1対1の会話練習で実践を積む前に、婚活を成功させるために、女性から会話を引き出す・会話を深堀するの2点に注力して練習します。
- 基本的には、会話のシチュエーションに応じた回答を4択から選びます。回答では解説とともに、見本となる音声ファイルを掲載します。再生ボタンを押すとシャドウィングして練習することができます。

## 機能概要

### 目的
- 婚活会話における深堀り質問スキルの習得
- 相手との距離を縮める自然な質問技術の向上
- 会話を続けるための具体的な質問パターンの学習
- 女性から会話を引き出す技術の習得

### 対象ユーザー
- 会話を深められない男性
- 質問が浅く、会話が続かない方
- 相手の興味・価値観を探るのが苦手な方
- 女性との会話に自信がない方

## 新機能：4択クイズ形式の練習モード

### 練習フロー詳細

#### 1. シチュエーション提示
```
[状況設定]
初めてのデートで、相手の女性が次のように話しました：

👤 女性（28歳・事務職）
「最近、料理にハマっているんです」

この発言に対して、会話を深堀りする最も適切な返答はどれでしょう？
```

#### 2. 4択問題形式
```
A. 「へぇ、そうなんですね」
   
B. 「どんな料理を作られるんですか？得意料理とかありますか？」
   
C. 「料理ですか。僕は全然できないんですよ」
   
D. 「料理は健康にいいですよね」

[選択して回答]
```

#### 3. 回答後のフィードバック
```
[正解: B]

✅ 解説
「どんな料理を作られるんですか？」という具体的な質問で、相手の興味を深堀りできています。
さらに「得意料理とかありますか？」と続けることで、相手が話しやすい雰囲気を作っています。

❌ 他の選択肢の問題点
A: 相槌だけで会話が続きません
C: 自分の話にすり替えてしまっています  
D: 一般論で会話が深まりません

🎧 音声見本
[▶️ 再生] ← クリックして模範音声を聞く
「どんな料理を作られるんですか？得意料理とかありますか？」
（優しく興味深そうなトーンで）

📝 シャドウィング練習
音声を聞きながら、同じトーンとスピードで繰り返し練習しましょう
[🎤 録音して比較] ← 自分の声を録音して比較できます
```

### シャドウィング練習機能

#### 音声再生機能
- 模範音声の再生（プロの声優による自然な会話トーン）
- 再生速度調整（0.5x, 0.75x, 1.0x, 1.25x）
- リピート再生機能
- 区間リピート機能

#### 録音比較機能
```javascript
// シャドウィング練習コンポーネント
const ShadowingPractice = {
  // 模範音声再生
  playModel: async () => {
    // 音声ファイルを再生
  },
  
  // ユーザー録音
  recordUser: async () => {
    // ユーザーの音声を録音
  },
  
  // 波形比較表示
  compareWaveforms: () => {
    // 模範音声とユーザー音声の波形を視覚的に比較
  },
  
  // トーン分析
  analyzeTone: () => {
    // 声のトーン、スピード、抑揚を分析
  }
}
```

### 練習問題のバリエーション

#### カテゴリー別問題集

**1. 趣味・興味について**
```
状況: 「映画を見るのが好きです」
正解: 「最近見た映画で印象的だったものはありますか？どんなところが良かったですか？」
```

**2. 仕事について**
```
状況: 「保育士をしています」
正解: 「子供たちと接していて、やりがいを感じるのはどんな時ですか？」
```

**3. 休日の過ごし方**
```
状況: 「休日はカフェ巡りをしています」
正解: 「お気に入りのカフェはありますか？どんな雰囲気のお店が好きですか？」
```

**4. 価値観について**
```
状況: 「家族との時間を大切にしています」
正解: 「ご家族とはどんな風に過ごされることが多いんですか？」
```

### 難易度別設定

#### Level 1: 基礎編
- 単純な深堀り質問
- 具体的な内容を聞く
- 4択の差が明確

#### Level 2: 応用編
- 感情を含めた質問
- 理由や背景を探る
- 4択の差が微妙

#### Level 3: 実践編
- 価値観に触れる質問
- 将来の話題につなげる
- 実際の会話に近い選択肢

## 学習管理システム

### 進捗トラッキング
```javascript
{
  "user_learning_progress": {
    "total_questions": 120,
    "completed_questions": 45,
    "accuracy_rate": 78,
    "category_progress": {
      "hobby": { "completed": 15, "accuracy": 80 },
      "work": { "completed": 10, "accuracy": 70 },
      "values": { "completed": 8, "accuracy": 75 },
      "daily_life": { "completed": 12, "accuracy": 83 }
    },
    "shadowing_practice": {
      "total_minutes": 45,
      "recordings_made": 23,
      "tone_improvement": 15
    }
  }
}
```

### 成果の可視化
```
[学習レポート]

📊 今週の成果
- 問題正答率: 78% (先週比 +5%)
- シャドウィング練習: 45分
- マスターした質問パターン: 12個

🏆 獲得バッジ
- 「深堀りマスター Level 1」
- 「感情質問の達人」
- 「継続は力なり（7日連続）」

📈 改善ポイント
- 価値観に関する質問をもっと練習しましょう
- トーンの抑揚をつける練習を増やしましょう
```

## UI詳細設計

### 4択問題画面
```
[深堀り質問練習 - Level 1]

📝 状況
初デートのカフェで、相手の女性が話しました。

👤 みゆきさん（26歳・看護師）
「最近ヨガを始めたんです」

❓ この発言への最適な返答は？

□ A. 「ヨガって体に良さそうですね」
□ B. 「どのくらいの頻度で通われているんですか？きっかけは何かあったんですか？」
□ C. 「僕もスポーツは好きです」
□ D. 「ヨガは難しくないですか？」

[ヒントを見る] [回答する]

進捗: ■■■□□□□□□□ 3/10
```

### シャドウィング練習画面
```
[シャドウィング練習]

🎯 練習フレーズ
「どのくらいの頻度で通われているんですか？きっかけは何かあったんですか？」

🎧 模範音声
[▶️ 再生] [⏸ 一時停止] [🔁 リピート]
速度: [0.5x][0.75x][1.0x✓][1.25x]

📊 音声波形
[模範音声の波形表示]
[あなたの音声の波形表示]

🎤 あなたの練習
[録音開始] [録音停止] [再生]

💡 ポイント
- 優しく興味深そうなトーンで
- 「〜ですか？」の語尾は上げる
- 自然な間を意識する

[もう一度練習] [次の問題へ]
```

### 解説画面
```
[解説とアドバイス]

✅ 正解！

📝 ポイント解説
この質問が良い理由：
1. 「どのくらいの頻度で」→ 具体的な情報を引き出す
2. 「きっかけは」→ 動機や背景を知ることで相手を理解
3. 2つの質問を自然につなげている

🎯 会話の展開例
女性：「週2回くらいです。仕事のストレスが溜まってて...」
あなた：「看護師さんのお仕事は大変ですよね。ヨガでリラックスできていますか？」

💡 応用テクニック
相手の職業（看護師）と関連付けて共感を示すと、より深い会話につながります

[音声で練習] [次の問題へ] [解説を保存]
```

## データベース追加設計

### テーブル: quiz_questions
```sql
CREATE TABLE quiz_questions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    category VARCHAR(50) NOT NULL,
    level INT NOT NULL,
    situation_text TEXT NOT NULL,
    partner_info JSON,
    correct_answer CHAR(1) NOT NULL,
    options JSON NOT NULL,
    explanation TEXT NOT NULL,
    audio_file_url VARCHAR(255),
    key_points JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### テーブル: shadowing_sessions
```sql
CREATE TABLE shadowing_sessions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL,
    question_id BIGINT NOT NULL,
    model_audio_url VARCHAR(255),
    user_audio_url VARCHAR(255),
    duration_seconds INT,
    tone_score INT,
    speed_score INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (question_id) REFERENCES quiz_questions(id)
);
```

## 実装優先順位

### Phase 1: 基本4択システム
1. 4択問題の表示・回答機能
2. 基本的な解説表示
3. 進捗管理機能

### Phase 2: 音声機能追加
1. 模範音声の再生機能
2. シャドウィング練習機能
3. 録音・比較機能

### Phase 3: 高度な分析
1. トーン分析機能
2. 個別アドバイス生成
3. 学習プラン最適化

この練習モードにより、ユーザーは実践前に十分な準備ができ、女性との会話に自信を持って臨めるようになります。